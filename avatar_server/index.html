<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.01//en" "http://www.w3.org/tr/html4/strict.dtd">
<html>
<head>
    <title>Avatar Control Center</title>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
    <link type="text/css" href="css/ui-darkness/jquery-ui-1.8.13.custom.css" rel="Stylesheet">
    <link rel="stylesheet" href="css/blueprint/screen.css" type="text/css" media="screen, projection">
    <link rel="stylesheet" href="css/blueprint/print.css" type="text/css" media="print">
    <link rel="stylesheet" href="css/layout-default-latest.css" type="text/css">
    <link rel="stylesheet" href="css/avatar.css" type="text/css">

</head>
<body>

<script type="text/javascript" src="js/socket.io.js"></script>
<script type="text/javascript" src="js/jquery-1.5.1.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.8.13.custom.min.js"></script>
<script type="text/javascript" src="js/jquery.layout-latest.js"></script>
<script>
    $(document).ready(function () {
        $('body').layout({
                    applyDefaultStyles: true,
                    resizable: false,
                    north__size: 100,
                    north__resizable: true,
                    south__size: 100,
                    south__resizable: true
                });
    });
</script>

<script>
    // Warning constants
    var COLLISION_WARNING = "C";
    var START_CHAR = "!";
    var STOP_CHAR = "?";
    var messageFromServer = "";
    var inMessage = false;
    var socket = new io.Socket("localhost", {port: 80});
    socket.connect();
    socket.on('connect', function() {
        console.log("Client: Client connected to server");
    });
    socket.on('message', function(data) {

        // Need to build message because it comes back in chunks
        if (data.charAt(0) == START_CHAR && data.charAt(data.length - 1) == STOP_CHAR) {
            logMessageReceivedFromServer(data.substring(1, data.length - 1));
            return;
        }

        if (data.charAt(0) == START_CHAR) {
            inMessage = true;
            messageFromServer = data.substring(1, data.length - 1);
            return;
        }

        if (data.charAt(data.length - 1) == STOP_CHAR && inMessage) {
            messageFromServer = messageFromServer.concat(data.substring(0, data.length - 1));
            logMessageReceivedFromServer(messageFromServer);
            messageFromServer = "";
            inMessage = false;
        }
    });

    socket.on('disconnect', function() {
        console.log("Client: Client disconnected from server");
    });

    function logMessageReceivedFromServer(code) {
        var message;
        var messageType = code.charAt(0);
        switch (messageType) {
            case COLLISION_WARNING:
                message = "Collision warning. Front sensor is " + code.substr(1, code.length - 1) + " cm from object."
                break;
            default:
                message = "Unknown Message"

        }
        console.log("Client: Received message from server", message);
    }

    function sendMessageToServer(message) {
        socket.send(START_CHAR + message + STOP_CHAR);
    }
</script>

<script>
    // Command constants
    var FORWARD = 'f';
    var REVERSE = 'b';
    var RIGHT = 'r';
    var LEFT = 'l';
    var STOP = 's';
    var EMERGENCY_STOP = 'S';

    $(function() {
        $("#fwd").button();
        $("#fwd").click(function() {
            sendMessageToServer(FORWARD)
        });

        $("#rev").button();
        $("#rev").click(function() {
            sendMessageToServer(REVERSE)
        });

        $("#right").button();
        $("#right").click(function() {
            sendMessageToServer(RIGHT)
        });

        $("#left").button();
        $("#left").click(function() {
            sendMessageToServer(LEFT)
        });

        $("#stop").button();
        $("#stop").click(function() {
            sendMessageToServer(STOP)
        });

        $("#emergency_stop").button();
        $("#emergency_stop").click(function() {
            sendMessageToServer(EMERGENCY_STOP)
        });

        $("#debug").button();
        $("#debug").click(function() {
//            sendMessageToServer(EMERGENCY_STOP)
        });

        $(function() {
            $("#rampSpeedSlider").slider({
                        range: "min",
                        min: 0,
                        max: 100,
                        value: 60,
                        slide: function(event, ui) {
                            $("#rampSpeed").val(ui.value);
                        },
                        change: function(event, ui) {
                            sendMessageToServer(ui.value);
                        }

                    });
            $("#rampSpeed").val($("#rampSpeedSlider").slider("value"));
        });

        $(function() {
            $("#maxSpeedSlider").slider({
                        range: "min",
                        min: 0,
                        max: 100,
                        value: 60,
                        slide: function(event, ui) {
                            $("#maxSpeed").val(ui.value);
                        }
                    });
            $("#maxSpeed").val($("#maxSpeedSlider").slider("value"));
        });

        $(function() {
            $("#forwardDistanceSlider").slider({
                        range: "min",
                        min: 0,
                        max: 100,
                        value: 60,
                        slide: function(event, ui) {
                            $("#forwardDistance").val(ui.value);
                        }
                    });
            $("#forwardDistance").val($("#forwardDistanceSlider").slider("value"));
        });

        $(function() {
            $("#reverseDistanceSlider").slider({
                        range: "min",
                        min: 0,
                        max: 100,
                        value: 60,
                        slide: function(event, ui) {
                            $("#reverseDistance").val(ui.value);
                        }
                    });
            $("#reverseDistance").val($("#reverseDistanceSlider").slider("value"));
        });

        $(function() {
            $("#rotationDistanceSlider").slider({
                        range: "min",
                        min: 0,
                        max: 100,
                        value: 60,
                        slide: function(event, ui) {
                            $("#rotationDistance").val(ui.value);
                        }
                    });
            $("#rotationDistance").val($("#rotationDistanceSlider").slider("value"));
        });

        $(function() {
            $("#frontSensorSlider").slider({
                        range: "min",
                        min: 0,
                        max: 100,
                        value: 60,
                        slide: function(event, ui) {
                            $("#frontSensor").val(ui.value);
                        }
                    });
            $("#frontSensor").val($("#frontSensorSlider").slider("value"));
        });

    });


</script>
<div class="ui-layout-center">
    <div class="container">

        <div class="span-24 prepend-2">
            <button id="fwd">FWD</button>
        </div>
        <div class="span-2">
            <button id="left">LEFT</button>
        </div>
        <div class="span-2">
            <button id="stop">STOP</button>
        </div>
        <div class="span-2 colborder">
            <button id="right">RIGHT</button>
        </div>

        <div class="span-24 prepend-2">
            <button id="rev">REV</button>
        </div>
        <div class="span-24 prepend-1">
            <button id="emergency_stop">EMERGENCY STOP</button>
        </div>


    </div>
</div>

<div class="ui-layout-east">
    <label for="rampSpeed">Ramp speed:</label>
    <input type="text" id="rampSpeed" style="border:0; color:#f6931f; font-weight:bold;"/>

    <div id="rampSpeedSlider"></div>

    <label for="maxSpeed">Max speed:</label>
    <input type="text" id="maxSpeed" style="border:0; color:#f6931f; font-weight:bold;"/>

    <div id="maxSpeedSlider"></div>

    <label for="forwardDistance">Forward distance:</label>
    <input type="text" id="forwardDistance" style="border:0; color:#f6931f; font-weight:bold;"/>

    <div id="forwardDistanceSlider"></div>

    <label for="reverseDistance">Reverse distance:</label>
    <input type="text" id="reverseDistance" style="border:0; color:#f6931f; font-weight:bold;"/>

    <div id="reverseDistanceSlider"></div>

    <label for="rotationDistance">Rotation distance:</label>
    <input type="text" id="rotationDistance" style="border:0; color:#f6931f; font-weight:bold;"/>

    <div id="rotationDistanceSlider"></div>
    <hr>
    <label for="frontSensor">Front sensor distance warning:</label>
    <input type="text" id="frontSensor" style="border:0; color:#f6931f; font-weight:bold;"/>

    <div id="frontSensorSlider"></div>


</div>
<div class="ui-layout-north">
    Avatar messages
</div>

<div class="ui-layout-south">
    <input type="checkbox" id="debug"/><label for="debug">Debug</label>
    Debug output
</div>

<!--<div class="ui-layout-west">-->
<!--West-->
<!--</div>-->


</body>
</html>